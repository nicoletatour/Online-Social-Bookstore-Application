package myy803.socialbookstore;

import static org.junit.jupiter.api.Assertions.assertEquals;
import static org.junit.jupiter.api.Assertions.assertTrue;

import java.util.ArrayList;
import java.util.List;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.junit.jupiter.api.extension.ExtendWith;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.boot.test.autoconfigure.jdbc.AutoConfigureTestDatabase;
import org.springframework.boot.test.autoconfigure.orm.jpa.DataJpaTest;
import org.springframework.test.context.junit.jupiter.SpringExtension;

import myy803.socialbookstore.datamodel.Book;
import myy803.socialbookstore.datamodel.BookAuthor;
import myy803.socialbookstore.datamodel.BookCategory;
import myy803.socialbookstore.datamodel.User;
import myy803.socialbookstore.datamodel.UserProfile;
import myy803.socialbookstore.mappers.BookAuthorMapper;
import myy803.socialbookstore.mappers.BookCategoryMapper;
import myy803.socialbookstore.mappers.BookMapper;
import myy803.socialbookstore.mappers.UserMapper;
import myy803.socialbookstore.mappers.UserProfileMapper;
import myy803.socialbookstore.services.BookOfferServiceImpl;



@ExtendWith(SpringExtension.class)
@DataJpaTest
@AutoConfigureTestDatabase(replace = AutoConfigureTestDatabase.Replace.NONE)
public class SocialBookStoreTests {

    @Autowired
    private UserProfileMapper userProfileMapper;

    @Autowired
    private UserMapper userMapper;

    @Autowired
    private BookMapper bookMapper;

    @Autowired
    private BookCategoryMapper bookCategoryMapper;

    @Autowired
    private BookAuthorMapper bookAuthorMapper;
    
    private BookOfferServiceImpl bookOfferService;
    private UserProfile userProfile;
    private BookAuthor bookAuthor;
    private BookCategory bookCategory;
    private User user;

    @BeforeEach
    public void setUp() {

        user = new User();
        user.setUsername("ioanna");
        userMapper.save(user);

        userProfile = new UserProfile();
        userProfile.setUsername("ioanna");
        userProfile.setFullName("Ioanna Ioanna");
        userProfile.setAge(22);

        List<BookAuthor> favoriteAuthors = new ArrayList<>();
        favoriteAuthors.add(bookAuthor);
        userProfile.setFavouriteBookAuthors(favoriteAuthors);
        
        List<BookAuthor> bookAuthors = new ArrayList<>();
        List<Book> books = new ArrayList<>();

        userProfileMapper.save(userProfile);
        
        book = new Book("Harry Potter and the Philosofer's Stone");
        books.add(book);
        
        userMapper.save(user);
        bookAuthorMapper.save(bookAuthor);
        bookCategoryMapper.save(bookCategory);
        userProfileMapper.save(userProfile);
    }
    @Test
    public void testSaveUserProfile() {

        UserProfile userProfile = userProfileMapper.findByUsername("ioanna");

        assertTrue(userProfile != null, "UserProfile should not be null");

        assertEquals("Ioanna Ioanna", userProfile.getFullName(), "Full name should match");
        assertEquals(22, userProfile.getAge(), "Age should match");
    }
    
    



}
